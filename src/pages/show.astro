---
import ItemPreview from "@components/ItemPreview.astro";
import Layout from "@layouts/Layout.astro";

const req = await fetch(`${import.meta.env.HN_API}/showstories.json`);
const data: undefined | number[] = await req.json();
if (!data) return Astro.redirect("/404");

const posts = await Promise.all(
  [...data]
    .splice(0, 30)
    .map((id) =>
      fetch(`${import.meta.env.HN_API}/item/${id}.json`).then(async (resp) => await resp.json())
    )
);
---

<Layout title="Show">
  <div class="flex flex-col gap-3">
    {posts.map((post) => <ItemPreview data={post} />)}
  </div>
</Layout>
